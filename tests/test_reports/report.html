<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8"/>
    <title id="head-title">report.html</title>
      <link href="assets/style.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <h1 id="title">report.html</h1>
    <p>Report generated on 04-Nov-2024 at 02:55:19 by <a href="https://pypi.python.org/pypi/pytest-html">pytest-html</a>
        v4.1.1</p>
    <div id="environment-header">
      <h2>Environment</h2>
    </div>
    <table id="environment"></table>
    <!-- TEMPLATES -->
      <template id="template_environment_row">
      <tr>
        <td></td>
        <td></td>
      </tr>
    </template>
    <template id="template_results-table__body--empty">
      <tbody class="results-table-row">
        <tr id="not-found-message">
          <td colspan="4">No results found. Check the filters.</th>
        </tr>
    </template>
    <template id="template_results-table__tbody">
      <tbody class="results-table-row">
        <tr class="collapsible">
        </tr>
        <tr class="extras-row">
          <td class="extra" colspan="4">
            <div class="extraHTML"></div>
            <div class="media">
              <div class="media-container">
                  <div class="media-container__nav--left"><</div>
                  <div class="media-container__viewport">
                    <img src="" />
                    <video controls>
                      <source src="" type="video/mp4">
                    </video>
                  </div>
                  <div class="media-container__nav--right">></div>
                </div>
                <div class="media__name"></div>
                <div class="media__counter"></div>
            </div>
            <div class="logwrapper">
              <div class="logexpander"></div>
              <div class="log"></div>
            </div>
          </td>
        </tr>
      </tbody>
    </template>
    <!-- END TEMPLATES -->
    <div class="summary">
      <div class="summary__data">
        <h2>Summary</h2>
        <div class="additional-summary prefix">
        </div>
        <p class="run-count">6 tests took 00:00:13.</p>
        <p class="filter">(Un)check the boxes to filter the results.</p>
        <div class="summary__reload">
          <div class="summary__reload__button hidden" onclick="location.reload()">
            <div>There are still tests running. <br />Reload this page to get the latest results!</div>
          </div>
        </div>
        <div class="summary__spacer"></div>
        <div class="controls">
          <div class="filters">
            <input checked="true" class="filter" name="filter_checkbox" type="checkbox" data-test-result="failed" />
            <span class="failed">4 Failed,</span>
            <input checked="true" class="filter" name="filter_checkbox" type="checkbox" data-test-result="passed" />
            <span class="passed">2 Passed,</span>
            <input checked="true" class="filter" name="filter_checkbox" type="checkbox" data-test-result="skipped" disabled/>
            <span class="skipped">0 Skipped,</span>
            <input checked="true" class="filter" name="filter_checkbox" type="checkbox" data-test-result="xfailed" disabled/>
            <span class="xfailed">0 Expected failures,</span>
            <input checked="true" class="filter" name="filter_checkbox" type="checkbox" data-test-result="xpassed" disabled/>
            <span class="xpassed">0 Unexpected passes,</span>
            <input checked="true" class="filter" name="filter_checkbox" type="checkbox" data-test-result="error" disabled/>
            <span class="error">0 Errors,</span>
            <input checked="true" class="filter" name="filter_checkbox" type="checkbox" data-test-result="rerun" disabled/>
            <span class="rerun">0 Reruns</span>
          </div>
          <div class="collapse">
            <button id="show_all_details">Show all details</button>&nbsp;/&nbsp;<button id="hide_all_details">Hide all details</button>
          </div>
        </div>
      </div>
      <div class="additional-summary summary">
      </div>
      <div class="additional-summary postfix">
      </div>
    </div>
    <table id="results-table">
      <thead id="results-table-head">
        <tr>
          <th class="sortable" data-column-type="result">Result</th>
          <th class="sortable" data-column-type="testId">Test</th>
          <th class="sortable" data-column-type="duration">Duration</th>
          <th>Links</th>
        </tr>
      </thead>
    </table>
  </body>
  <footer>
    <div id="data-container" data-jsonblob="{&#34;environment&#34;: {&#34;Python&#34;: &#34;3.10.13&#34;, &#34;Platform&#34;: &#34;macOS-12.7.6-x86_64-i386-64bit&#34;, &#34;Packages&#34;: {&#34;pytest&#34;: &#34;8.2.0&#34;, &#34;pluggy&#34;: &#34;1.5.0&#34;}, &#34;Plugins&#34;: {&#34;sugar&#34;: &#34;1.0.0&#34;, &#34;html&#34;: &#34;4.1.1&#34;, &#34;metadata&#34;: &#34;3.1.1&#34;, &#34;anyio&#34;: &#34;3.7.1&#34;}}, &#34;tests&#34;: {&#34;test_sukoon.py::test_route_query&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_sukoon.py::test_route_query&#34;, &#34;duration&#34;: &#34;00:00:05&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_sukoon.py::test_route_query&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:05&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;------------------------------ Captured log call -------------------------------\nINFO     test_sukoon:test_sukoon.py:83 Starting route_query test\nINFO     httpx:_client.py:1026 HTTP Request: POST https://api.openai.com/v1/chat/completions &amp;quot;HTTP/1.1 200 OK&amp;quot;\nINFO     test_sukoon:test_sukoon.py:77 {\n  &amp;quot;test_case&amp;quot;: &amp;quot;happy_path&amp;quot;,\n  &amp;quot;input&amp;quot;: {\n    &amp;quot;type&amp;quot;: &amp;quot;HumanMessage&amp;quot;,\n    &amp;quot;content&amp;quot;: &amp;quot;Test message&amp;quot;,\n    &amp;quot;additional_kwargs&amp;quot;: {}\n  },\n  &amp;quot;route&amp;quot;: &amp;quot;conversational&amp;quot;\n}\nINFO     httpx:_client.py:1026 HTTP Request: POST https://api.openai.com/v1/chat/completions &amp;quot;HTTP/1.1 200 OK&amp;quot;\nINFO     test_sukoon:test_sukoon.py:77 {\n  &amp;quot;test_case&amp;quot;: &amp;quot;concerning_content&amp;quot;,\n  &amp;quot;input&amp;quot;: {\n    &amp;quot;type&amp;quot;: &amp;quot;HumanMessage&amp;quot;,\n    &amp;quot;content&amp;quot;: &amp;quot;I&amp;#x27;m thinking of ending it all&amp;quot;,\n    &amp;quot;additional_kwargs&amp;quot;: {}\n  },\n  &amp;quot;route&amp;quot;: &amp;quot;suicide_prevention&amp;quot;\n}\n\n&#34;}], &#34;test_sukoon.py::test_run_conversational_agent&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_sukoon.py::test_run_conversational_agent&#34;, &#34;duration&#34;: &#34;782 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_sukoon.py::test_run_conversational_agent&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;782 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;mock_openai = &amp;lt;MagicMock name=&amp;#x27;ChatOpenAI&amp;#x27; id=&amp;#x27;4540764496&amp;#x27;&amp;gt;, mock_state = {&amp;#x27;messages&amp;#x27;: [HumanMessage(content=&amp;#x27;Test message&amp;#x27;, additional_kwargs={}, response_metadata={})]}\ncaplog = &amp;lt;_pytest.logging.LogCaptureFixture object at 0x10ea69060&amp;gt;\n\n    def test_run_conversational_agent(mock_openai, mock_state, caplog):\n        logger.info(&amp;quot;Starting conversational agent test&amp;quot;)\n    \n        expected_response = &amp;quot;Hi there! How can I help you today?&amp;quot;\n        mock_openai.return_value.invoke.return_value = expected_response\n    \n        result = run_conversational_agent(mock_state)\n        log_json({\n            &amp;quot;test&amp;quot;: &amp;quot;conversational_agent&amp;quot;,\n            &amp;quot;input&amp;quot;: serialize_message(mock_state[&amp;#x27;messages&amp;#x27;][-1]),\n            &amp;quot;output&amp;quot;: result\n        })\n        assert isinstance(result, dict)\n        assert &amp;quot;messages&amp;quot; in result\n&amp;gt;       assert result[&amp;quot;messages&amp;quot;] == expected_response\nE       assert AIMessage(content=&amp;quot;Hi there! \ud83d\ude0a What&amp;#x27;s been on your mind lately? How are you feeling these days?&amp;quot;, additional_kwargs={&amp;#x27;refusal&amp;#x27;: None}, response_metadata={&amp;#x27;token_usage&amp;#x27;: {&amp;#x27;completion_tokens&amp;#x27;: 18, &amp;#x27;prompt_tokens&amp;#x27;: 442, &amp;#x27;total_tokens&amp;#x27;: 460, &amp;#x27;completion_tokens_details&amp;#x27;: {&amp;#x27;audio_tokens&amp;#x27;: None, &amp;#x27;reasoning_tokens&amp;#x27;: 0}, &amp;#x27;prompt_tokens_details&amp;#x27;: {&amp;#x27;audio_tokens&amp;#x27;: None, &amp;#x27;cached_tokens&amp;#x27;: 0}}, &amp;#x27;model_name&amp;#x27;: &amp;#x27;gpt-4o-2024-08-06&amp;#x27;, &amp;#x27;system_fingerprint&amp;#x27;: &amp;#x27;fp_159d8341cc&amp;#x27;, &amp;#x27;finish_reason&amp;#x27;: &amp;#x27;stop&amp;#x27;, &amp;#x27;logprobs&amp;#x27;: None}, id=&amp;#x27;run-fcdc498d-bcd4-492d-809a-436afdf21068-0&amp;#x27;, usage_metadata={&amp;#x27;input_tokens&amp;#x27;: 442, &amp;#x27;output_tokens&amp;#x27;: 18, &amp;#x27;total_tokens&amp;#x27;: 460}) == &amp;#x27;Hi there! How can I help you today?&amp;#x27;\n\ntest_sukoon.py:123: AssertionError\n\n----------------------------- Captured stdout call -----------------------------\nRunning conversational agent\n\n------------------------------ Captured log call -------------------------------\nINFO     test_sukoon:test_sukoon.py:110 Starting conversational agent test\nINFO     httpx:_client.py:1026 HTTP Request: POST https://api.openai.com/v1/chat/completions &amp;quot;HTTP/1.1 200 OK&amp;quot;\nINFO     test_sukoon:test_sukoon.py:77 {\n  &amp;quot;test&amp;quot;: &amp;quot;conversational_agent&amp;quot;,\n  &amp;quot;input&amp;quot;: {\n    &amp;quot;type&amp;quot;: &amp;quot;HumanMessage&amp;quot;,\n    &amp;quot;content&amp;quot;: &amp;quot;Test message&amp;quot;,\n    &amp;quot;additional_kwargs&amp;quot;: {}\n  },\n  &amp;quot;output&amp;quot;: {\n    &amp;quot;messages&amp;quot;: {\n      &amp;quot;type&amp;quot;: &amp;quot;AIMessage&amp;quot;,\n      &amp;quot;content&amp;quot;: &amp;quot;Hi there! \\ud83d\\ude0a What&amp;#x27;s been on your mind lately? How are you feeling these days?&amp;quot;,\n      &amp;quot;additional_kwargs&amp;quot;: {\n        &amp;quot;refusal&amp;quot;: null\n      }\n    }\n  }\n}\n\n&#34;}], &#34;test_sukoon.py::test_run_suicide_prevention_agent&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_sukoon.py::test_run_suicide_prevention_agent&#34;, &#34;duration&#34;: &#34;00:00:02&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_sukoon.py::test_run_suicide_prevention_agent&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:02&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;mock_openai = &amp;lt;MagicMock name=&amp;#x27;ChatOpenAI&amp;#x27; id=&amp;#x27;4545823936&amp;#x27;&amp;gt;, mock_state = {&amp;#x27;messages&amp;#x27;: [HumanMessage(content=&amp;#x27;Test message&amp;#x27;, additional_kwargs={}, response_metadata={})]}\ncaplog = &amp;lt;_pytest.logging.LogCaptureFixture object at 0x10ee9ece0&amp;gt;\n\n    def test_run_suicide_prevention_agent(mock_openai, mock_state, caplog):\n        logger.info(&amp;quot;Starting suicide prevention agent test&amp;quot;)\n    \n        expected_response = &amp;quot;I hear that you&amp;#x27;re going through a difficult time. I&amp;#x27;m here to support you.&amp;quot;\n        mock_openai.return_value.invoke.return_value = expected_response\n    \n        result = run_suicide_prevention_agent(mock_state)\n        log_json({\n            &amp;quot;test&amp;quot;: &amp;quot;suicide_prevention_agent&amp;quot;,\n            &amp;quot;input&amp;quot;: serialize_message(mock_state[&amp;#x27;messages&amp;#x27;][-1]),\n            &amp;quot;output&amp;quot;: result\n        })\n        assert isinstance(result, dict)\n        assert &amp;quot;messages&amp;quot; in result\n&amp;gt;       assert result[&amp;quot;messages&amp;quot;] == expected_response\nE       assert AIMessage(content=&amp;quot;Thank you for reaching out. How can I assist you today? If you or someone you know is struggling, it&amp;#x27;s important to talk about it. I&amp;#x27;m here to listen and help connect you to the right resources. Remember, your life matters, and we can find support together. You can contact professional help at these suicide prevention helplines:\\n\\n- iCALL: +919152987821\\n- NIMHANS: +918046110007 or 14416\\n\\nPlease feel free to share what&amp;#x27;s on your mind.&amp;quot;, additional_kwargs={&amp;#x27;refusal&amp;#x27;: None}, response_metadata={&amp;#x27;token_usage&amp;#x27;: {&amp;#x27;completion_tokens&amp;#x27;: 104, &amp;#x27;prompt_tokens&amp;#x27;: 196, &amp;#x27;total_tokens&amp;#x27;: 300, &amp;#x27;completion_tokens_details&amp;#x27;: {&amp;#x27;audio_tokens&amp;#x27;: None, &amp;#x27;reasoning_tokens&amp;#x27;: 0}, &amp;#x27;prompt_tokens_details&amp;#x27;: {&amp;#x27;audio_tokens&amp;#x27;: None, &amp;#x27;cached_tokens&amp;#x27;: 0}}, &amp;#x27;model_name&amp;#x27;: &amp;#x27;gpt-4o-2024-08-06&amp;#x27;, &amp;#x27;system_fingerprint&amp;#x27;: &amp;#x27;fp_45cf54deae&amp;#x27;, &amp;#x27;finish_reason&amp;#x27;: &amp;#x27;stop&amp;#x27;, &amp;#x27;logprobs&amp;#x27;: None}, id=&amp;#x27;run-c9b2c7a5-07d6-4d0a-bdf7-36bd2a96bf6e-0&amp;#x27;, usage_metadata={&amp;#x27;input_tokens&amp;#x27;: 196, &amp;#x27;output_tokens&amp;#x27;: 104, &amp;#x27;total_tokens&amp;#x27;: 300}) == &amp;quot;I hear that you&amp;#x27;re going through a difficult time. I&amp;#x27;m here to support you.&amp;quot;\n\ntest_sukoon.py:139: AssertionError\n\n----------------------------- Captured stdout call -----------------------------\nRunning suicide prevention agent\n\n------------------------------ Captured log call -------------------------------\nINFO     test_sukoon:test_sukoon.py:126 Starting suicide prevention agent test\nINFO     httpx:_client.py:1026 HTTP Request: POST https://api.openai.com/v1/chat/completions &amp;quot;HTTP/1.1 200 OK&amp;quot;\nINFO     test_sukoon:test_sukoon.py:77 {\n  &amp;quot;test&amp;quot;: &amp;quot;suicide_prevention_agent&amp;quot;,\n  &amp;quot;input&amp;quot;: {\n    &amp;quot;type&amp;quot;: &amp;quot;HumanMessage&amp;quot;,\n    &amp;quot;content&amp;quot;: &amp;quot;Test message&amp;quot;,\n    &amp;quot;additional_kwargs&amp;quot;: {}\n  },\n  &amp;quot;output&amp;quot;: {\n    &amp;quot;messages&amp;quot;: {\n      &amp;quot;type&amp;quot;: &amp;quot;AIMessage&amp;quot;,\n      &amp;quot;content&amp;quot;: &amp;quot;Thank you for reaching out. How can I assist you today? If you or someone you know is struggling, it&amp;#x27;s important to talk about it. I&amp;#x27;m here to listen and help connect you to the right resources. Remember, your life matters, and we can find support together. You can contact professional help at these suicide prevention helplines:\\n\\n- iCALL: +919152987821\\n- NIMHANS: +918046110007 or 14416\\n\\nPlease feel free to share what&amp;#x27;s on your mind.&amp;quot;,\n      &amp;quot;additional_kwargs&amp;quot;: {\n        &amp;quot;refusal&amp;quot;: null\n      }\n    }\n  }\n}\n\n&#34;}], &#34;test_sukoon.py::test_chat_routing[I&#39;m feeling happy today-conversational-That&#39;s wonderful to hear! I&#39;m glad you&#39;re feeling happy today.]&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_sukoon.py::test_chat_routing[I&#39;m feeling happy today-conversational-That&#39;s wonderful to hear! I&#39;m glad you&#39;re feeling happy today.]&#34;, &#34;duration&#34;: &#34;00:00:02&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_sukoon.py::test_chat_routing[I&#39;m feeling happy today-conversational-That&#39;s wonderful to hear! I&#39;m glad you&#39;re feeling happy today.]&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:02&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;mock_openai = &amp;lt;MagicMock name=&amp;#x27;ChatOpenAI&amp;#x27; id=&amp;#x27;4545832864&amp;#x27;&amp;gt;, input_message = &amp;quot;I&amp;#x27;m feeling happy today&amp;quot;, expected_route = &amp;#x27;conversational&amp;#x27;\nexpected_response = &amp;quot;That&amp;#x27;s wonderful to hear! I&amp;#x27;m glad you&amp;#x27;re feeling happy today.&amp;quot;, caplog = &amp;lt;_pytest.logging.LogCaptureFixture object at 0x10ef3ed40&amp;gt;\n\n    @pytest.mark.parametrize(&amp;quot;input_message,expected_route,expected_response&amp;quot;, [\n        (\n            &amp;quot;I&amp;#x27;m feeling happy today&amp;quot;,\n            &amp;quot;conversational&amp;quot;,\n            &amp;quot;That&amp;#x27;s wonderful to hear! I&amp;#x27;m glad you&amp;#x27;re feeling happy today.&amp;quot;\n        ),\n        (\n            &amp;quot;I&amp;#x27;m thinking about ending it all&amp;quot;,\n            &amp;quot;suicide_prevention&amp;quot;,\n            &amp;quot;I&amp;#x27;m very concerned about what you&amp;#x27;re sharing. Your life has value and there are people who want to help.&amp;quot;\n        ),\n    ])\n    def test_chat_routing(mock_openai, input_message, expected_route, expected_response, caplog):\n        logger.info(f&amp;quot;Starting chat routing test with input: {input_message}&amp;quot;)\n    \n        mock_structured = Mock()\n        mock_openai.return_value.with_structured_output.return_value = mock_structured\n        mock_structured.invoke.return_value.route = expected_route\n        mock_openai.return_value.invoke.return_value = expected_response\n    \n        config = {&amp;quot;configurable&amp;quot;: {&amp;quot;thread_id&amp;quot;: &amp;quot;test&amp;quot;}}\n        response = chat(input_message, config)\n    \n        log_json({\n            &amp;quot;test&amp;quot;: &amp;quot;chat_routing&amp;quot;,\n            &amp;quot;input&amp;quot;: input_message,\n            &amp;quot;route&amp;quot;: expected_route,\n            &amp;quot;output&amp;quot;: response\n        })\n&amp;gt;       assert response == expected_response\nE       assert AIMessage(content=&amp;quot;That&amp;#x27;s wonderful to hear! \ud83d\ude0a What do you think is the reason behind your happiness today?&amp;quot;, additional_kwargs={&amp;#x27;refusal&amp;#x27;: None}, response_metadata={&amp;#x27;token_usage&amp;#x27;: {&amp;#x27;completion_tokens&amp;#x27;: 18, &amp;#x27;prompt_tokens&amp;#x27;: 470, &amp;#x27;total_tokens&amp;#x27;: 488, &amp;#x27;completion_tokens_details&amp;#x27;: {&amp;#x27;audio_tokens&amp;#x27;: None, &amp;#x27;reasoning_tokens&amp;#x27;: 0}, &amp;#x27;prompt_tokens_details&amp;#x27;: {&amp;#x27;audio_tokens&amp;#x27;: None, &amp;#x27;cached_tokens&amp;#x27;: 0}}, &amp;#x27;model_name&amp;#x27;: &amp;#x27;gpt-4o-2024-08-06&amp;#x27;, &amp;#x27;system_fingerprint&amp;#x27;: &amp;#x27;fp_159d8341cc&amp;#x27;, &amp;#x27;finish_reason&amp;#x27;: &amp;#x27;stop&amp;#x27;, &amp;#x27;logprobs&amp;#x27;: None}, id=&amp;#x27;run-03be1106-a5c4-4739-bb2a-2ee54a036a85-0&amp;#x27;, usage_metadata={&amp;#x27;input_tokens&amp;#x27;: 470, &amp;#x27;output_tokens&amp;#x27;: 18, &amp;#x27;total_tokens&amp;#x27;: 488}) == &amp;quot;That&amp;#x27;s wonderful to hear! I&amp;#x27;m glad you&amp;#x27;re feeling happy today.&amp;quot;\n\ntest_sukoon.py:170: AssertionError\n\n----------------------------- Captured stdout call -----------------------------\nRunning conversational agent\n\n------------------------------ Captured log call -------------------------------\nINFO     test_sukoon:test_sukoon.py:154 Starting chat routing test with input: I&amp;#x27;m feeling happy today\nINFO     httpx:_client.py:1026 HTTP Request: POST https://api.openai.com/v1/chat/completions &amp;quot;HTTP/1.1 200 OK&amp;quot;\nINFO     httpx:_client.py:1026 HTTP Request: POST https://api.openai.com/v1/chat/completions &amp;quot;HTTP/1.1 200 OK&amp;quot;\nINFO     test_sukoon:test_sukoon.py:77 {\n  &amp;quot;test&amp;quot;: &amp;quot;chat_routing&amp;quot;,\n  &amp;quot;input&amp;quot;: &amp;quot;I&amp;#x27;m feeling happy today&amp;quot;,\n  &amp;quot;route&amp;quot;: &amp;quot;conversational&amp;quot;,\n  &amp;quot;output&amp;quot;: {\n    &amp;quot;type&amp;quot;: &amp;quot;AIMessage&amp;quot;,\n    &amp;quot;content&amp;quot;: &amp;quot;That&amp;#x27;s wonderful to hear! \\ud83d\\ude0a What do you think is the reason behind your happiness today?&amp;quot;,\n    &amp;quot;additional_kwargs&amp;quot;: {\n      &amp;quot;refusal&amp;quot;: null\n    }\n  }\n}\n\n&#34;}], &#34;test_sukoon.py::test_chat_routing[I&#39;m thinking about ending it all-suicide_prevention-I&#39;m very concerned about what you&#39;re sharing. Your life has value and there are people who want to help.]&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Failed&#34;, &#34;testId&#34;: &#34;test_sukoon.py::test_chat_routing[I&#39;m thinking about ending it all-suicide_prevention-I&#39;m very concerned about what you&#39;re sharing. Your life has value and there are people who want to help.]&#34;, &#34;duration&#34;: &#34;00:00:03&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Failed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_sukoon.py::test_chat_routing[I&#39;m thinking about ending it all-suicide_prevention-I&#39;m very concerned about what you&#39;re sharing. Your life has value and there are people who want to help.]&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;00:00:03&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;mock_openai = &amp;lt;MagicMock name=&amp;#x27;ChatOpenAI&amp;#x27; id=&amp;#x27;4546510032&amp;#x27;&amp;gt;, input_message = &amp;quot;I&amp;#x27;m thinking about ending it all&amp;quot;, expected_route = &amp;#x27;suicide_prevention&amp;#x27;\nexpected_response = &amp;quot;I&amp;#x27;m very concerned about what you&amp;#x27;re sharing. Your life has value and there are people who want to help.&amp;quot;\ncaplog = &amp;lt;_pytest.logging.LogCaptureFixture object at 0x10efe3d00&amp;gt;\n\n    @pytest.mark.parametrize(&amp;quot;input_message,expected_route,expected_response&amp;quot;, [\n        (\n            &amp;quot;I&amp;#x27;m feeling happy today&amp;quot;,\n            &amp;quot;conversational&amp;quot;,\n            &amp;quot;That&amp;#x27;s wonderful to hear! I&amp;#x27;m glad you&amp;#x27;re feeling happy today.&amp;quot;\n        ),\n        (\n            &amp;quot;I&amp;#x27;m thinking about ending it all&amp;quot;,\n            &amp;quot;suicide_prevention&amp;quot;,\n            &amp;quot;I&amp;#x27;m very concerned about what you&amp;#x27;re sharing. Your life has value and there are people who want to help.&amp;quot;\n        ),\n    ])\n    def test_chat_routing(mock_openai, input_message, expected_route, expected_response, caplog):\n        logger.info(f&amp;quot;Starting chat routing test with input: {input_message}&amp;quot;)\n    \n        mock_structured = Mock()\n        mock_openai.return_value.with_structured_output.return_value = mock_structured\n        mock_structured.invoke.return_value.route = expected_route\n        mock_openai.return_value.invoke.return_value = expected_response\n    \n        config = {&amp;quot;configurable&amp;quot;: {&amp;quot;thread_id&amp;quot;: &amp;quot;test&amp;quot;}}\n        response = chat(input_message, config)\n    \n        log_json({\n            &amp;quot;test&amp;quot;: &amp;quot;chat_routing&amp;quot;,\n            &amp;quot;input&amp;quot;: input_message,\n            &amp;quot;route&amp;quot;: expected_route,\n            &amp;quot;output&amp;quot;: response\n        })\n&amp;gt;       assert response == expected_response\nE       assert AIMessage(content=&amp;quot;I&amp;#x27;m really sorry to hear that you&amp;#x27;re feeling this way. Let&amp;#x27;s talk about it, and remember, your life matters. Let&amp;#x27;s get you the support you need right now. \\n\\nCan you share more about what&amp;#x27;s been going on for you? I&amp;#x27;m here to listen and help you find the right resources. It&amp;#x27;s important to reach out to someone who can provide professional support. \\n\\nPlease consider contacting one of these helplines:\\n- iCALL: +919152987821\\n- NIMHANS: +918046110007 or 14416\\n\\nThese services are there to help you. You&amp;#x27;re not alone in this.&amp;quot;, additional_kwargs={&amp;#x27;refusal&amp;#x27;: None}, response_metadata={&amp;#x27;token_usage&amp;#x27;: {&amp;#x27;completion_tokens&amp;#x27;: 122, &amp;#x27;prompt_tokens&amp;#x27;: 460, &amp;#x27;total_tokens&amp;#x27;: 582, &amp;#x27;completion_tokens_details&amp;#x27;: {&amp;#x27;audio_tokens&amp;#x27;: None, &amp;#x27;reasoning_tokens&amp;#x27;: 0}, &amp;#x27;prompt_tokens_details&amp;#x27;: {&amp;#x27;audio_tokens&amp;#x27;: None, &amp;#x27;cached_tokens&amp;#x27;: 0}}, &amp;#x27;model_name&amp;#x27;: &amp;#x27;gpt-4o-2024-08-06&amp;#x27;, &amp;#x27;system_fingerprint&amp;#x27;: &amp;#x27;fp_45cf54deae&amp;#x27;, &amp;#x27;finish_reason&amp;#x27;: &amp;#x27;stop&amp;#x27;, &amp;#x27;logprobs&amp;#x27;: None}, id=&amp;#x27;run-fb6ef841-93a1-43e1-a1fa-ea9346379992-0&amp;#x27;, usage_metadata={&amp;#x27;input_tokens&amp;#x27;: 460, &amp;#x27;output_tokens&amp;#x27;: 122, &amp;#x27;total_tokens&amp;#x27;: 582}) == &amp;quot;I&amp;#x27;m very concerned about what you&amp;#x27;re sharing. Your life has value and there are people who want to help.&amp;quot;\n\ntest_sukoon.py:170: AssertionError\n\n----------------------------- Captured stdout call -----------------------------\nRunning suicide prevention agent\n\n------------------------------ Captured log call -------------------------------\nINFO     test_sukoon:test_sukoon.py:154 Starting chat routing test with input: I&amp;#x27;m thinking about ending it all\nINFO     httpx:_client.py:1026 HTTP Request: POST https://api.openai.com/v1/chat/completions &amp;quot;HTTP/1.1 200 OK&amp;quot;\nINFO     httpx:_client.py:1026 HTTP Request: POST https://api.openai.com/v1/chat/completions &amp;quot;HTTP/1.1 200 OK&amp;quot;\nINFO     test_sukoon:test_sukoon.py:77 {\n  &amp;quot;test&amp;quot;: &amp;quot;chat_routing&amp;quot;,\n  &amp;quot;input&amp;quot;: &amp;quot;I&amp;#x27;m thinking about ending it all&amp;quot;,\n  &amp;quot;route&amp;quot;: &amp;quot;suicide_prevention&amp;quot;,\n  &amp;quot;output&amp;quot;: {\n    &amp;quot;type&amp;quot;: &amp;quot;AIMessage&amp;quot;,\n    &amp;quot;content&amp;quot;: &amp;quot;I&amp;#x27;m really sorry to hear that you&amp;#x27;re feeling this way. Let&amp;#x27;s talk about it, and remember, your life matters. Let&amp;#x27;s get you the support you need right now. \\n\\nCan you share more about what&amp;#x27;s been going on for you? I&amp;#x27;m here to listen and help you find the right resources. It&amp;#x27;s important to reach out to someone who can provide professional support. \\n\\nPlease consider contacting one of these helplines:\\n- iCALL: +919152987821\\n- NIMHANS: +918046110007 or 14416\\n\\nThese services are there to help you. You&amp;#x27;re not alone in this.&amp;quot;,\n    &amp;quot;additional_kwargs&amp;quot;: {\n      &amp;quot;refusal&amp;quot;: null\n    }\n  }\n}\n\n&#34;}], &#34;test_sukoon.py::test_error_handling&#34;: [{&#34;extras&#34;: [], &#34;result&#34;: &#34;Passed&#34;, &#34;testId&#34;: &#34;test_sukoon.py::test_error_handling&#34;, &#34;duration&#34;: &#34;761 ms&#34;, &#34;resultsTableRow&#34;: [&#34;&lt;td class=\&#34;col-result\&#34;&gt;Passed&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-testId\&#34;&gt;test_sukoon.py::test_error_handling&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-duration\&#34;&gt;761 ms&lt;/td&gt;&#34;, &#34;&lt;td class=\&#34;col-links\&#34;&gt;&lt;/td&gt;&#34;], &#34;log&#34;: &#34;----------------------------- Captured stdout call -----------------------------\nRunning conversational agent\n\n------------------------------ Captured log call -------------------------------\nINFO     test_sukoon:test_sukoon.py:173 Starting error handling test\nINFO     httpx:_client.py:1026 HTTP Request: POST https://api.openai.com/v1/chat/completions &amp;quot;HTTP/1.1 200 OK&amp;quot;\n\n&#34;}]}, &#34;renderCollapsed&#34;: [&#34;passed&#34;], &#34;initialSort&#34;: &#34;result&#34;, &#34;title&#34;: &#34;report.html&#34;}"></div>
    <script>
      (function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){
const { getCollapsedCategory, setCollapsedIds } = require('./storage.js')

class DataManager {
    setManager(data) {
        const collapsedCategories = [...getCollapsedCategory(data.renderCollapsed)]
        const collapsedIds = []
        const tests = Object.values(data.tests).flat().map((test, index) => {
            const collapsed = collapsedCategories.includes(test.result.toLowerCase())
            const id = `test_${index}`
            if (collapsed) {
                collapsedIds.push(id)
            }
            return {
                ...test,
                id,
                collapsed,
            }
        })
        const dataBlob = { ...data, tests }
        this.data = { ...dataBlob }
        this.renderData = { ...dataBlob }
        setCollapsedIds(collapsedIds)
    }

    get allData() {
        return { ...this.data }
    }

    resetRender() {
        this.renderData = { ...this.data }
    }

    setRender(data) {
        this.renderData.tests = [...data]
    }

    toggleCollapsedItem(id) {
        this.renderData.tests = this.renderData.tests.map((test) =>
            test.id === id ? { ...test, collapsed: !test.collapsed } : test,
        )
    }

    set allCollapsed(collapsed) {
        this.renderData = { ...this.renderData, tests: [...this.renderData.tests.map((test) => (
            { ...test, collapsed }
        ))] }
    }

    get testSubset() {
        return [...this.renderData.tests]
    }

    get environment() {
        return this.renderData.environment
    }

    get initialSort() {
        return this.data.initialSort
    }
}

module.exports = {
    manager: new DataManager(),
}

},{"./storage.js":8}],2:[function(require,module,exports){
const mediaViewer = require('./mediaviewer.js')
const templateEnvRow = document.getElementById('template_environment_row')
const templateResult = document.getElementById('template_results-table__tbody')

function htmlToElements(html) {
    const temp = document.createElement('template')
    temp.innerHTML = html
    return temp.content.childNodes
}

const find = (selector, elem) => {
    if (!elem) {
        elem = document
    }
    return elem.querySelector(selector)
}

const findAll = (selector, elem) => {
    if (!elem) {
        elem = document
    }
    return [...elem.querySelectorAll(selector)]
}

const dom = {
    getStaticRow: (key, value) => {
        const envRow = templateEnvRow.content.cloneNode(true)
        const isObj = typeof value === 'object' && value !== null
        const values = isObj ? Object.keys(value).map((k) => `${k}: ${value[k]}`) : null

        const valuesElement = htmlToElements(
            values ? `<ul>${values.map((val) => `<li>${val}</li>`).join('')}<ul>` : `<div>${value}</div>`)[0]
        const td = findAll('td', envRow)
        td[0].textContent = key
        td[1].appendChild(valuesElement)

        return envRow
    },
    getResultTBody: ({ testId, id, log, extras, resultsTableRow, tableHtml, result, collapsed }) => {
        const resultBody = templateResult.content.cloneNode(true)
        resultBody.querySelector('tbody').classList.add(result.toLowerCase())
        resultBody.querySelector('tbody').id = testId
        resultBody.querySelector('.collapsible').dataset.id = id

        resultsTableRow.forEach((html) => {
            const t = document.createElement('template')
            t.innerHTML = html
            resultBody.querySelector('.collapsible').appendChild(t.content)
        })

        if (log) {
            // Wrap lines starting with "E" with span.error to color those lines red
            const wrappedLog = log.replace(/^E.*$/gm, (match) => `<span class="error">${match}</span>`)
            resultBody.querySelector('.log').innerHTML = wrappedLog
        } else {
            resultBody.querySelector('.log').remove()
        }

        if (collapsed) {
            resultBody.querySelector('.collapsible > td')?.classList.add('collapsed')
            resultBody.querySelector('.extras-row').classList.add('hidden')
        } else {
            resultBody.querySelector('.collapsible > td')?.classList.remove('collapsed')
        }

        const media = []
        extras?.forEach(({ name, format_type, content }) => {
            if (['image', 'video'].includes(format_type)) {
                media.push({ path: content, name, format_type })
            }

            if (format_type === 'html') {
                resultBody.querySelector('.extraHTML').insertAdjacentHTML('beforeend', `<div>${content}</div>`)
            }
        })
        mediaViewer.setup(resultBody, media)

        // Add custom html from the pytest_html_results_table_html hook
        tableHtml?.forEach((item) => {
            resultBody.querySelector('td[class="extra"]').insertAdjacentHTML('beforeend', item)
        })

        return resultBody
    },
}

module.exports = {
    dom,
    htmlToElements,
    find,
    findAll,
}

},{"./mediaviewer.js":6}],3:[function(require,module,exports){
const { manager } = require('./datamanager.js')
const { doSort } = require('./sort.js')
const storageModule = require('./storage.js')

const getFilteredSubSet = (filter) =>
    manager.allData.tests.filter(({ result }) => filter.includes(result.toLowerCase()))

const doInitFilter = () => {
    const currentFilter = storageModule.getVisible()
    const filteredSubset = getFilteredSubSet(currentFilter)
    manager.setRender(filteredSubset)
}

const doFilter = (type, show) => {
    if (show) {
        storageModule.showCategory(type)
    } else {
        storageModule.hideCategory(type)
    }

    const currentFilter = storageModule.getVisible()
    const filteredSubset = getFilteredSubSet(currentFilter)
    manager.setRender(filteredSubset)

    const sortColumn = storageModule.getSort()
    doSort(sortColumn, true)
}

module.exports = {
    doFilter,
    doInitFilter,
}

},{"./datamanager.js":1,"./sort.js":7,"./storage.js":8}],4:[function(require,module,exports){
const { redraw, bindEvents, renderStatic } = require('./main.js')
const { doInitFilter } = require('./filter.js')
const { doInitSort } = require('./sort.js')
const { manager } = require('./datamanager.js')
const data = JSON.parse(document.getElementById('data-container').dataset.jsonblob)

function init() {
    manager.setManager(data)
    doInitFilter()
    doInitSort()
    renderStatic()
    redraw()
    bindEvents()
}

init()

},{"./datamanager.js":1,"./filter.js":3,"./main.js":5,"./sort.js":7}],5:[function(require,module,exports){
const { dom, find, findAll } = require('./dom.js')
const { manager } = require('./datamanager.js')
const { doSort } = require('./sort.js')
const { doFilter } = require('./filter.js')
const {
    getVisible,
    getCollapsedIds,
    setCollapsedIds,
    getSort,
    getSortDirection,
    possibleFilters,
} = require('./storage.js')

const removeChildren = (node) => {
    while (node.firstChild) {
        node.removeChild(node.firstChild)
    }
}

const renderStatic = () => {
    const renderEnvironmentTable = () => {
        const environment = manager.environment
        const rows = Object.keys(environment).map((key) => dom.getStaticRow(key, environment[key]))
        const table = document.getElementById('environment')
        removeChildren(table)
        rows.forEach((row) => table.appendChild(row))
    }
    renderEnvironmentTable()
}

const addItemToggleListener = (elem) => {
    elem.addEventListener('click', ({ target }) => {
        const id = target.parentElement.dataset.id
        manager.toggleCollapsedItem(id)

        const collapsedIds = getCollapsedIds()
        if (collapsedIds.includes(id)) {
            const updated = collapsedIds.filter((item) => item !== id)
            setCollapsedIds(updated)
        } else {
            collapsedIds.push(id)
            setCollapsedIds(collapsedIds)
        }
        redraw()
    })
}

const renderContent = (tests) => {
    const sortAttr = getSort(manager.initialSort)
    const sortAsc = JSON.parse(getSortDirection())
    const rows = tests.map(dom.getResultTBody)
    const table = document.getElementById('results-table')
    const tableHeader = document.getElementById('results-table-head')

    const newTable = document.createElement('table')
    newTable.id = 'results-table'

    // remove all sorting classes and set the relevant
    findAll('.sortable', tableHeader).forEach((elem) => elem.classList.remove('asc', 'desc'))
    tableHeader.querySelector(`.sortable[data-column-type="${sortAttr}"]`)?.classList.add(sortAsc ? 'desc' : 'asc')
    newTable.appendChild(tableHeader)

    if (!rows.length) {
        const emptyTable = document.getElementById('template_results-table__body--empty').content.cloneNode(true)
        newTable.appendChild(emptyTable)
    } else {
        rows.forEach((row) => {
            if (!!row) {
                findAll('.collapsible td:not(.col-links', row).forEach(addItemToggleListener)
                find('.logexpander', row).addEventListener('click',
                    (evt) => evt.target.parentNode.classList.toggle('expanded'),
                )
                newTable.appendChild(row)
            }
        })
    }

    table.replaceWith(newTable)
}

const renderDerived = () => {
    const currentFilter = getVisible()
    possibleFilters.forEach((result) => {
        const input = document.querySelector(`input[data-test-result="${result}"]`)
        input.checked = currentFilter.includes(result)
    })
}

const bindEvents = () => {
    const filterColumn = (evt) => {
        const { target: element } = evt
        const { testResult } = element.dataset

        doFilter(testResult, element.checked)
        const collapsedIds = getCollapsedIds()
        const updated = manager.renderData.tests.map((test) => {
            return {
                ...test,
                collapsed: collapsedIds.includes(test.id),
            }
        })
        manager.setRender(updated)
        redraw()
    }

    const header = document.getElementById('environment-header')
    header.addEventListener('click', () => {
        const table = document.getElementById('environment')
        table.classList.toggle('hidden')
        header.classList.toggle('collapsed')
    })

    findAll('input[name="filter_checkbox"]').forEach((elem) => {
        elem.addEventListener('click', filterColumn)
    })

    findAll('.sortable').forEach((elem) => {
        elem.addEventListener('click', (evt) => {
            const { target: element } = evt
            const { columnType } = element.dataset
            doSort(columnType)
            redraw()
        })
    })

    document.getElementById('show_all_details').addEventListener('click', () => {
        manager.allCollapsed = false
        setCollapsedIds([])
        redraw()
    })
    document.getElementById('hide_all_details').addEventListener('click', () => {
        manager.allCollapsed = true
        const allIds = manager.renderData.tests.map((test) => test.id)
        setCollapsedIds(allIds)
        redraw()
    })
}

const redraw = () => {
    const { testSubset } = manager

    renderContent(testSubset)
    renderDerived()
}

module.exports = {
    redraw,
    bindEvents,
    renderStatic,
}

},{"./datamanager.js":1,"./dom.js":2,"./filter.js":3,"./sort.js":7,"./storage.js":8}],6:[function(require,module,exports){
class MediaViewer {
    constructor(assets) {
        this.assets = assets
        this.index = 0
    }

    nextActive() {
        this.index = this.index === this.assets.length - 1 ? 0 : this.index + 1
        return [this.activeFile, this.index]
    }

    prevActive() {
        this.index = this.index === 0 ? this.assets.length - 1 : this.index -1
        return [this.activeFile, this.index]
    }

    get currentIndex() {
        return this.index
    }

    get activeFile() {
        return this.assets[this.index]
    }
}


const setup = (resultBody, assets) => {
    if (!assets.length) {
        resultBody.querySelector('.media').classList.add('hidden')
        return
    }

    const mediaViewer = new MediaViewer(assets)
    const container = resultBody.querySelector('.media-container')
    const leftArrow = resultBody.querySelector('.media-container__nav--left')
    const rightArrow = resultBody.querySelector('.media-container__nav--right')
    const mediaName = resultBody.querySelector('.media__name')
    const counter = resultBody.querySelector('.media__counter')
    const imageEl = resultBody.querySelector('img')
    const sourceEl = resultBody.querySelector('source')
    const videoEl = resultBody.querySelector('video')

    const setImg = (media, index) => {
        if (media?.format_type === 'image') {
            imageEl.src = media.path

            imageEl.classList.remove('hidden')
            videoEl.classList.add('hidden')
        } else if (media?.format_type === 'video') {
            sourceEl.src = media.path

            videoEl.classList.remove('hidden')
            imageEl.classList.add('hidden')
        }

        mediaName.innerText = media?.name
        counter.innerText = `${index + 1} / ${assets.length}`
    }
    setImg(mediaViewer.activeFile, mediaViewer.currentIndex)

    const moveLeft = () => {
        const [media, index] = mediaViewer.prevActive()
        setImg(media, index)
    }
    const doRight = () => {
        const [media, index] = mediaViewer.nextActive()
        setImg(media, index)
    }
    const openImg = () => {
        window.open(mediaViewer.activeFile.path, '_blank')
    }
    if (assets.length === 1) {
        container.classList.add('media-container--fullscreen')
    } else {
        leftArrow.addEventListener('click', moveLeft)
        rightArrow.addEventListener('click', doRight)
    }
    imageEl.addEventListener('click', openImg)
}

module.exports = {
    setup,
}

},{}],7:[function(require,module,exports){
const { manager } = require('./datamanager.js')
const storageModule = require('./storage.js')

const genericSort = (list, key, ascending, customOrder) => {
    let sorted
    if (customOrder) {
        sorted = list.sort((a, b) => {
            const aValue = a.result.toLowerCase()
            const bValue = b.result.toLowerCase()

            const aIndex = customOrder.findIndex((item) => item.toLowerCase() === aValue)
            const bIndex = customOrder.findIndex((item) => item.toLowerCase() === bValue)

            // Compare the indices to determine the sort order
            return aIndex - bIndex
        })
    } else {
        sorted = list.sort((a, b) => a[key] === b[key] ? 0 : a[key] > b[key] ? 1 : -1)
    }

    if (ascending) {
        sorted.reverse()
    }
    return sorted
}

const durationSort = (list, ascending) => {
    const parseDuration = (duration) => {
        if (duration.includes(':')) {
            // If it's in the format "HH:mm:ss"
            const [hours, minutes, seconds] = duration.split(':').map(Number)
            return (hours * 3600 + minutes * 60 + seconds) * 1000
        } else {
            // If it's in the format "nnn ms"
            return parseInt(duration)
        }
    }
    const sorted = list.sort((a, b) => parseDuration(a['duration']) - parseDuration(b['duration']))
    if (ascending) {
        sorted.reverse()
    }
    return sorted
}

const doInitSort = () => {
    const type = storageModule.getSort(manager.initialSort)
    const ascending = storageModule.getSortDirection()
    const list = manager.testSubset
    const initialOrder = ['Error', 'Failed', 'Rerun', 'XFailed', 'XPassed', 'Skipped', 'Passed']

    storageModule.setSort(type)
    storageModule.setSortDirection(ascending)

    if (type?.toLowerCase() === 'original') {
        manager.setRender(list)
    } else {
        let sortedList
        switch (type) {
        case 'duration':
            sortedList = durationSort(list, ascending)
            break
        case 'result':
            sortedList = genericSort(list, type, ascending, initialOrder)
            break
        default:
            sortedList = genericSort(list, type, ascending)
            break
        }
        manager.setRender(sortedList)
    }
}

const doSort = (type, skipDirection) => {
    const newSortType = storageModule.getSort(manager.initialSort) !== type
    const currentAsc = storageModule.getSortDirection()
    let ascending
    if (skipDirection) {
        ascending = currentAsc
    } else {
        ascending = newSortType ? false : !currentAsc
    }
    storageModule.setSort(type)
    storageModule.setSortDirection(ascending)

    const list = manager.testSubset
    const sortedList = type === 'duration' ? durationSort(list, ascending) : genericSort(list, type, ascending)
    manager.setRender(sortedList)
}

module.exports = {
    doInitSort,
    doSort,
}

},{"./datamanager.js":1,"./storage.js":8}],8:[function(require,module,exports){
const possibleFilters = [
    'passed',
    'skipped',
    'failed',
    'error',
    'xfailed',
    'xpassed',
    'rerun',
]

const getVisible = () => {
    const url = new URL(window.location.href)
    const settings = new URLSearchParams(url.search).get('visible')
    const lower = (item) => {
        const lowerItem = item.toLowerCase()
        if (possibleFilters.includes(lowerItem)) {
            return lowerItem
        }
        return null
    }
    return settings === null ?
        possibleFilters :
        [...new Set(settings?.split(',').map(lower).filter((item) => item))]
}

const hideCategory = (categoryToHide) => {
    const url = new URL(window.location.href)
    const visibleParams = new URLSearchParams(url.search).get('visible')
    const currentVisible = visibleParams ? visibleParams.split(',') : [...possibleFilters]
    const settings = [...new Set(currentVisible)].filter((f) => f !== categoryToHide).join(',')

    url.searchParams.set('visible', settings)
    window.history.pushState({}, null, unescape(url.href))
}

const showCategory = (categoryToShow) => {
    if (typeof window === 'undefined') {
        return
    }
    const url = new URL(window.location.href)
    const currentVisible = new URLSearchParams(url.search).get('visible')?.split(',').filter(Boolean) ||
        [...possibleFilters]
    const settings = [...new Set([categoryToShow, ...currentVisible])]
    const noFilter = possibleFilters.length === settings.length || !settings.length

    noFilter ? url.searchParams.delete('visible') : url.searchParams.set('visible', settings.join(','))
    window.history.pushState({}, null, unescape(url.href))
}

const getSort = (initialSort) => {
    const url = new URL(window.location.href)
    let sort = new URLSearchParams(url.search).get('sort')
    if (!sort) {
        sort = initialSort || 'result'
    }
    return sort
}

const setSort = (type) => {
    const url = new URL(window.location.href)
    url.searchParams.set('sort', type)
    window.history.pushState({}, null, unescape(url.href))
}

const getCollapsedCategory = (renderCollapsed) => {
    let categories
    if (typeof window !== 'undefined') {
        const url = new URL(window.location.href)
        const collapsedItems = new URLSearchParams(url.search).get('collapsed')
        switch (true) {
        case !renderCollapsed && collapsedItems === null:
            categories = ['passed']
            break
        case collapsedItems?.length === 0 || /^["']{2}$/.test(collapsedItems):
            categories = []
            break
        case /^all$/.test(collapsedItems) || collapsedItems === null && /^all$/.test(renderCollapsed):
            categories = [...possibleFilters]
            break
        default:
            categories = collapsedItems?.split(',').map((item) => item.toLowerCase()) || renderCollapsed
            break
        }
    } else {
        categories = []
    }
    return categories
}

const getSortDirection = () => JSON.parse(sessionStorage.getItem('sortAsc')) || false
const setSortDirection = (ascending) => sessionStorage.setItem('sortAsc', ascending)

const getCollapsedIds = () => JSON.parse(sessionStorage.getItem('collapsedIds')) || []
const setCollapsedIds = (list) => sessionStorage.setItem('collapsedIds', JSON.stringify(list))

module.exports = {
    getVisible,
    hideCategory,
    showCategory,
    getCollapsedIds,
    setCollapsedIds,
    getSort,
    setSort,
    getSortDirection,
    setSortDirection,
    getCollapsedCategory,
    possibleFilters,
}

},{}]},{},[4]);
    </script>
  </footer>
</html>